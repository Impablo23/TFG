"use strict";(self.webpackChunkTorrecomelinos2=self.webpackChunkTorrecomelinos2||[]).push([[98],{9098:(J,g,u)=>{u.r(g),u.d(g,{AuthModule:()=>I});var v=u(6814),p=u(1896),n=u(5879);let A=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#n=this.\u0275cmp=n.Xpm({type:t,selectors:[["app-layout-auth"]],decls:1,vars:0,template:function(o,a){1&o&&n._UZ(0,"router-outlet")},dependencies:[p.lC]})}return t})();var m=u(5861);const h={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let c;const x=new Uint8Array(16);function U(){if(!c&&(c=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!c))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(x)}const s=[];for(let t=0;t<256;++t)s.push((t+256).toString(16).slice(1));const T=function M(t,r,e){if(h.randomUUID&&!r&&!t)return h.randomUUID();const o=(t=t||{}).random||(t.rng||U)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,r){e=e||0;for(let a=0;a<16;++a)r[e+a]=o[a];return r}return function b(t,r=0){return s[t[r+0]]+s[t[r+1]]+s[t[r+2]]+s[t[r+3]]+"-"+s[t[r+4]]+s[t[r+5]]+"-"+s[t[r+6]]+s[t[r+7]]+"-"+s[t[r+8]]+s[t[r+9]]+"-"+s[t[r+10]]+s[t[r+11]]+s[t[r+12]]+s[t[r+13]]+s[t[r+14]]+s[t[r+15]]}(o)};var C=u(7874),y=u(2939),f=u(2539),k=u(2296),d=u(6223);const w=[{path:"",component:A,children:[{path:"login",component:(()=>{class t{constructor(e,o,a){this.router=e,this.snackbar=o,this.authApi=a,this.email="",this.pass="",this.token=""}ngOnInit(){}calcularHashMD5(e){return C.MD5(e).toString()}loginApi(){var e=this;return(0,m.Z)(function*(){if(""!==e.email&&""!==e.pass)try{const o=yield e.authApi.getToken(e.email,e.pass).toPromise();e.token=o.access_token;const l=(yield e.authApi.getUserByEmailAndPass(e.email,e.calcularHashMD5(e.pass),e.token).toPromise())[0];if(null!=l){const i={id:l.id,email:l.email,passwd:l.passwd,nombreCompleto:l.nombreCompleto,idRol:l.idRol,token:T(),verificado:1};yield e.authApi.updateUser(i,e.token).toPromise();const R={id:0,id_usuario:i.id,estado:"Conectado",hora:e.authApi.obtenerFechaYHora((new Date).toISOString())};yield e.authApi.addRegistroApi(R,e.token).toPromise(),sessionStorage.setItem("id",i.id.toString()),sessionStorage.setItem("email",i.email),sessionStorage.setItem("nombreCompleto",i.nombreCompleto),sessionStorage.setItem("idRol",i.idRol.toString()),sessionStorage.setItem("token",i.token),sessionStorage.setItem("tokenApi",e.token),e.snackbar.open("Inicio de Sesi\xf3n Correcto","Cerrar",{duration:2e3,panelClass:["background"]}),e.router.navigate(["/establecimientos"])}else e.email="",e.pass="",e.snackbar.open("Inicio de Sesi\xf3n Incorrecto","Cerrar",{duration:2e3,panelClass:["background"]})}catch{e.snackbar.open("Inicio de Sesi\xf3n Incorrecto","Cerrar",{duration:2e3,panelClass:["background"]}),e.email="",e.pass=""}else e.snackbar.open("No has rellenado todos los datos requeridos","Cerrar",{duration:2e3,panelClass:["background"]})})()}static#e=this.\u0275fac=function(o){return new(o||t)(n.Y36(p.F0),n.Y36(y.ux),n.Y36(f.Q))};static#n=this.\u0275cmp=n.Xpm({type:t,selectors:[["app-login-page"]],decls:14,vars:2,consts:[[2,"background-image","url('../../../assets/logo-empresa.png')","height","296px","width","420px","margin","auto","margin-top","100px","border-radius","30px"],[2,"text-align","center","margin-top","50px","font-family","fantasy","color","black"],[1,"input-group","flex-nowrap",2,"width","50%","margin","auto"],["type","email","placeholder","Email*","aria-label","Username","aria-describedby","addon-wrapping","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group","flex-nowrap",2,"width","50%","margin","auto","margin-top","30px"],["type","password","placeholder","Contrase\xf1a*","aria-label","Username","aria-describedby","addon-wrapping","required","",1,"form-control",3,"ngModel","ngModelChange"],[2,"border","5px solid black","width","200px","height","45px","margin","auto","margin-top","30px","border-radius","10px"],["mat-raised-button","",2,"width","100%",3,"click"],[2,"text-align","center","margin-top","10px"],["href","/auth/register",2,"color","white"]],template:function(o,a){1&o&&(n._UZ(0,"div",0),n.TgZ(1,"h1",1),n._uU(2,"Iniciar Sesi\xf3n"),n.qZA(),n.TgZ(3,"div",2)(4,"input",3),n.NdJ("ngModelChange",function(i){return a.email=i}),n.qZA()(),n.TgZ(5,"div",4)(6,"input",5),n.NdJ("ngModelChange",function(i){return a.pass=i}),n.qZA()(),n.TgZ(7,"div",6)(8,"button",7),n.NdJ("click",function(){return a.loginApi()}),n._uU(9,"Iniciar Sesi\xf3n"),n.qZA()(),n.TgZ(10,"p",8),n._uU(11,"\xbfNo tienes cuenta?, "),n.TgZ(12,"a",9),n._uU(13,"\xa1Reg\xedstrate aqu\xed!"),n.qZA()()),2&o&&(n.xp6(4),n.Q6J("ngModel",a.email),n.xp6(2),n.Q6J("ngModel",a.pass))},dependencies:[k.lW,d.Fj,d.JJ,d.Q7,d.On]})}return t})()},{path:"register",component:(()=>{class t{constructor(e,o,a){this.router=e,this.snackbar=o,this.authApi=a,this.nombreCompleto="",this.email="",this.pass="",this.token=""}navigateToLogin(){this.router.navigate(["/auth"])}calcularHashMD5(e){return C.MD5(e).toString()}registrarApi(){var e=this;return(0,m.Z)(function*(){""!==e.email&&""!==e.pass&&""!==e.nombreCompleto?e.email.includes("@gmail.com")||e.email.includes("@hotmail.com")?e.nombreCompleto.length<5?e.snackbar.open("El nombre debe tener un m\xednimo de 5 caracteres","Cerrar",{duration:2e3,panelClass:["background"]}):e.pass.length<8?e.snackbar.open("La contrase\xf1a debe tener un m\xednimo de 8 caracteres","Cerrar",{duration:2e3,panelClass:["background"]}):e.authApi.getUserByEmail(e.email).subscribe(o=>{if(null==o[0]){const l={id:0,email:e.email,passwd:e.calcularHashMD5(e.pass),nombreCompleto:e.nombreCompleto,idRol:2,token:"",verificado:0};e.authApi.addUserApiRegister(l).subscribe(i=>{e.snackbar.open("Registro completado, Espera a la verificaci\xf3n del administrador","Cerrar",{duration:2e3,panelClass:["background"]}),e.router.navigate(["/auth"])})}else e.snackbar.open("El usuario registrado ya existe","Cerrar",{duration:2e3,panelClass:["background"]})}):e.snackbar.open("No has introducido un correo electr\xf3nico v\xe1lido","Cerrar",{duration:2e3,panelClass:["background"]}):e.snackbar.open("No has rellenado todos los datos requeridos","Cerrar",{duration:2e3,panelClass:["background"]})})()}static#e=this.\u0275fac=function(o){return new(o||t)(n.Y36(p.F0),n.Y36(y.ux),n.Y36(f.Q))};static#n=this.\u0275cmp=n.Xpm({type:t,selectors:[["app-register-page"]],decls:16,vars:3,consts:[[2,"background-image","url('../../../assets/logo-empresa.png')","height","296px","width","420px","margin","auto","margin-top","100px","border-radius","30px"],[2,"text-align","center","margin-top","50px","font-family","fantasy","color","black"],[1,"input-group","flex-nowrap",2,"width","50%","margin","auto"],["type","email","placeholder","Email*","aria-label","Username","aria-describedby","addon-wrapping","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group","flex-nowrap",2,"width","50%","margin","auto","margin-top","30px"],["type","text","placeholder","Nombre*","aria-label","Username","aria-describedby","addon-wrapping","required","",1,"form-control",3,"ngModel","ngModelChange"],["type","password","placeholder","Contrase\xf1a*","aria-label","Username","aria-describedby","addon-wrapping","required","",1,"form-control",3,"ngModel","ngModelChange"],[2,"border","5px solid black","width","200px","height","45px","margin","auto","margin-top","30px","border-radius","10px"],["mat-raised-button","",2,"width","100%",3,"click"],[2,"text-align","center","margin-top","10px"],["href","/auth/",2,"color","white"]],template:function(o,a){1&o&&(n._UZ(0,"div",0),n.TgZ(1,"h1",1),n._uU(2,"Registrarse"),n.qZA(),n.TgZ(3,"div",2)(4,"input",3),n.NdJ("ngModelChange",function(i){return a.email=i}),n.qZA()(),n.TgZ(5,"div",4)(6,"input",5),n.NdJ("ngModelChange",function(i){return a.nombreCompleto=i}),n.qZA()(),n.TgZ(7,"div",4)(8,"input",6),n.NdJ("ngModelChange",function(i){return a.pass=i}),n.qZA()(),n.TgZ(9,"div",7)(10,"button",8),n.NdJ("click",function(){return a.registrarApi()}),n._uU(11,"Crear Cuenta"),n.qZA()(),n.TgZ(12,"p",9),n._uU(13,"\xbfYa tienes cuenta?, "),n.TgZ(14,"a",10),n._uU(15,"\xa1Inicia Sesi\xf3n aqu\xed!"),n.qZA()()),2&o&&(n.xp6(4),n.Q6J("ngModel",a.email),n.xp6(2),n.Q6J("ngModel",a.nombreCompleto),n.xp6(2),n.Q6J("ngModel",a.pass))},dependencies:[k.lW,d.Fj,d.JJ,d.Q7,d.On]})}return t})()},{path:"**",redirectTo:"login"}]}];let Z=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#n=this.\u0275mod=n.oAB({type:t});static#t=this.\u0275inj=n.cJS({imports:[p.Bz.forChild(w),p.Bz]})}return t})();var S=u(1423);let I=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#n=this.\u0275mod=n.oAB({type:t});static#t=this.\u0275inj=n.cJS({imports:[v.ez,Z,S.q,d.u5]})}return t})()}}]);